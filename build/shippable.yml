# Language setting http://docs.shippable.com/ci/languages/node/
language: node_js
name: kiaweb_ciRepo
type: ciRepo
pointer:
  sourceName: SeamgenSD/kia.web

node_js: 
  #- 8.1.4 //change to node version to use
  
branches:
  only:
    - develop
    - qa

env:
  global:
    - AWS_ACCESS_KEY_ID=AKIAIO7ZC27Z54KNGWYQ
    - AWS_SECRET_ACCESS_KEY=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
    - AWS_DEFAULT_REGION=us-east-1
    ##DEFAULT
    - TEST_RESULTS_DIR=$SHIPPABLE_REPO_DIR/shippable/testresults
    - CODE_COVERAGE_DIR=$SHIPPABLE_REPO_DIR/shippable/codecoverage
    - TESTS_LOC_DIR=$SHIPPABLE_REPO_DIR/tests
    - MOD_LOC=$SHIPPABLE_REPO_DIR/node_modules/.bin/

install:
# npm mirrors can sometimes be flacky, better to use shippable_retry
    # http://docs.shippable.com/ci/advancedOptions/retry/
  # install global dependencies
    - shippable_retry npm install
    #- npm install -g @angular/cli@1.2.4 //Change to angular cli version to use
build:
  #pre_ci:
  ci:
    - if [ "$BRANCH" == "develop" ] && [ "$IS_PULL_REQUEST" == false ] ; then ng build; fi
    - if [ "$BRANCH" == "qa" ] && [ "$IS_PULL_REQUEST" == false ] ; then ng build; fi
  #post_ci:
  on_success:
    - if [ "$BRANCH" == "develop" ] && [ "$IS_PULL_REQUEST" == false ] ; then aws s3 sync $SHIPPABLE_REPO_DIR/dist s3://kia.web-dev --region $AWS_DEFAULT_REGION; fi
    - if [ "$BRANCH" == "qa" ] && [ "$IS_PULL_REQUEST" == false ] ; then aws s3 sync $SHIPPABLE_REPO_DIR/dist s3://kia.web-qa --region $AWS_DEFAULT_REGION; fi
 