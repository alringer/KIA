"use strict";$(document).ready(function(){window.myTrips={elements:{view:$(".my-trips-page-view"),trip:$(".trip"),trip_collapse:$(".trip .collapse"),badge_input:$(".trip .badge input"),badge_cancel:$(".trip .badge em"),trip_list_scroll:$(".trips-list-inner"),scroll_top:$(".scroll-top"),stop_propagation:$(".stop-propagation"),start_edit:$(".start-edit"),stop_edit:$(".stop-edit"),toggle_edit:$(".toggle-edit"),trip_checkboxes:$(".trip .checkbox input"),merge_buttons_wrap:$(".merge-toggle"),merge:$(".merge-toggle .merge"),unmerge:$(".merge-toggle .unmerge"),delete:$(".edit-toolbar .delete"),select_all:$(".select-all"),choose_format:$(".modal-export .choose-format input"),email:$('.modal-export input[type="email"]')},methods:{_stop_prop:function e(t){t.stopPropagation()},_toggle:function e(){var t=$(this),s=t.find(".collapse");t.hasClass("active")||(window.myTrips.elements.trip_collapse.collapse("hide"),window.myTrips.elements.trip.removeClass("active"),t.addClass("active"),s.collapse("show"))},tags:{_add:function e(){window.myTrips.methods.tags._save();var t=$(this),s=t.parents(".badge");s.addClass("adding"),s.parents(".trip-tags").addClass("focused")},_keyup:function e(t){var s=$(this),i=s.parents(".badge"),o=i.find("span"),n=s.val();if(32===t.keyCode)return void t.preventDefault();n.length>30&&(n=n.substr(0,30),s.val(n)),o.text(n.toLowerCase());var d=this;if(setTimeout(function(){d.selectionStart=d.selectionEnd=1e4},0),13===t.keyCode){window.myTrips.methods.tags._save();var r=i.find("input")}27===t.keyCode&&window.myTrips.methods.tags._cancel_element(i,!0)},_cancel:function e(){var t=$(this),s=t.parents(".badge");window.myTrips.methods.tags._cancel_element(s)},_cancel_element:function e(t,s){var i=t.find("input"),o=t.find("span"),n=t.parents(".trip-tags").find(".badge"),d=n.index(t);i.val(""),o.text(""),t.removeClass("adding"),t.parents(".trip-tags").removeClass("focused"),n.length>1&&d<n.length-1&&!s&&t.addClass("remove")},_save:function e(){var t=window.innerWidth<768?$(".modal.in .trip"):$(".trip.active"),s=t.find(".badge.adding"),i=s.find("span").text(),o=s.find("input"),n=s.parents(".trip-tags").find(".badge"),d=n.index(s);if(i.length){if(s.removeClass("add adding"),d===n.length-1){$('<span class="badge add">\n                    <span></span>\n                    <input type="text" name="" value="" tabindex="-1">\n                    <em>+</em>\n                  </span>').appendTo(t.find(".trip-tags")).find("input")}setTimeout(function(){o.blur()},100)}else window.myTrips.methods.tags._cancel_element(s)}},scroll:{onscroll:function e(t){window.myTrips.elements.trip_list_scroll.scrollTop()>10?window.myTrips.elements.trip_list_scroll.addClass("scrolled"):window.myTrips.elements.trip_list_scroll.removeClass("scrolled")},scrolltop:function e(t){window.myTrips.elements.trip_list_scroll.scrollTop(0)}},edit:{_start:function e(){$("body").addClass("editing")},_stop:function e(){$("body").removeClass("editing"),window.myTrips.elements.trip_checkboxes.prop("checked",!1),window.myTrips.elements.select_all.prop("checked",!1)},_checkbox_change:function e(){var t=window.myTrips.elements.trip_checkboxes.filter(":checked");t.length>1?window.myTrips.elements.merge_buttons_wrap.removeClass("disabled"):window.myTrips.elements.merge_buttons_wrap.addClass("disabled"),t.length?window.myTrips.elements.delete.removeClass("disabled"):window.myTrips.elements.delete.addClass("disabled");var s=!0;1===t.length&&t.parents(".trip.merged").length&&(window.myTrips.elements.merge_buttons_wrap.removeClass("disabled"),s=!1);var i=window.myTrips.elements.merge_buttons_wrap.find("span");i.removeClass("active"),s?i.filter(".merge").addClass("active"):i.filter(".unmerge").addClass("active")},_merge:function e(){var t=window.myTrips.elements.trip_checkboxes.filter(":checked").parents(".trip");t.addClass("merged"),t.not(".active").each(function(){var e=$(this);e.css("height",e.outerHeight()),setTimeout(function(){e.addClass("hide-trip")},10)}),window.myTrips.elements.trip_checkboxes.prop("checked",!1),window.myTrips.methods.edit._checkbox_change(),window.myTrips.methods.edit._stop()},_delete:function e(){window.myTrips.elements.trip_checkboxes.filter(":checked").parents(".trip").each(function(){var e=$(this);e.css("height",e.outerHeight()),setTimeout(function(){e.addClass("hide-trip")},10)}),window.myTrips.elements.trip_checkboxes.prop("checked",!1),window.myTrips.methods.edit._checkbox_change(),window.myTrips.methods.edit._stop()},_unmerge:function e(){var t=window.myTrips.elements.trip;t.removeClass("merged hide-trip"),setTimeout(function(){t.css("height","auto")},550),window.myTrips.methods.edit._checkbox_change(),window.myTrips.methods.edit._stop()},_select_all:function e(){var t=$(this),s=t.prop("checked");window.myTrips.elements.select_all.prop("checked",s),window.myTrips.elements.trip_checkboxes.each(function(){var e=$(this);e.parents(".trip").hasClass("hide-trip")||e.prop("checked",s)}),window.myTrips.methods.edit._checkbox_change()}},export:{_disable:function e(){var t=window.myTrips.elements.choose_format.filter(":checked").length,s=window.myTrips.elements.email.val().length;t&&s?$(".export-button").removeClass("disabled"):$(".export-button").addClass("disabled")}}}},window.myTrips.elements.trip.on("click",window.myTrips.methods._toggle),$("body").delegate(".trip .badge input","focus",window.myTrips.methods.tags._add),$("body").delegate(".trip .badge input","paste keyup keydown",window.myTrips.methods.tags._keyup),$("body").delegate(".trip .badge input","blur",window.myTrips.methods.tags._save),$("body").delegate(".trip .badge em","click",window.myTrips.methods.tags._cancel),window.myTrips.elements.trip_list_scroll.on("scroll",window.myTrips.methods.scroll.onscroll),window.myTrips.elements.scroll_top.on("click",window.myTrips.methods.scroll.scrolltop),window.myTrips.elements.stop_propagation.on("click",window.myTrips.methods._stop_prop),window.myTrips.elements.start_edit.on("click",window.myTrips.methods.edit._start),window.myTrips.elements.stop_edit.on("click",window.myTrips.methods.edit._stop),window.myTrips.elements.trip_checkboxes.on("change",window.myTrips.methods.edit._checkbox_change),window.myTrips.elements.merge.on("click",window.myTrips.methods.edit._merge),window.myTrips.elements.unmerge.on("click",window.myTrips.methods.edit._unmerge),window.myTrips.elements.delete.on("click",window.myTrips.methods.edit._delete),window.myTrips.elements.select_all.on("change",window.myTrips.methods.edit._select_all),window.myTrips.elements.choose_format.on("change",window.myTrips.methods.export._disable),window.myTrips.elements.email.on("keyup change paste",window.myTrips.methods.export._disable)});